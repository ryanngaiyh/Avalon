<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>⚔️ Avalon Lobby ⚔️</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body {
      margin: 0;
      font-family: "Cinzel", serif;
      background: #1a1a1a;
      color: #FFD700;
      text-align: center;
    }

    h1 {
      font-size: 30px;
      margin: 30px 0 20px;
      text-shadow: 0 0 10px #FFD700, 0 0 20px #ffae00;
    }

    .card {
      background: #000;
      border: 2px solid #FFD700;
      border-radius: 12px;
      padding: 20px;
      margin: 20px auto;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 0 15px #FFD70080;
    }

    h2 {
      font-size: 22px;
      margin-bottom: 15px;
      text-shadow: 0 0 8px #FFD700;
    }

    input {
      padding: 10px;
      width: 80%;
      max-width: 300px;
      border-radius: 8px;
      border: 2px solid #FFD700;
      background: #111;
      color: #FFD700;
      font-size: 16px;
      margin-bottom: 10px;
      text-align: center;
    }

    input:focus {
      outline: none;
      box-shadow: 0 0 10px #FFD700;
    }

    button {
      padding: 10px 18px;
      margin-top: 10px;
      border: 2px solid #FFD700;
      border-radius: 8px;
      background: #000;
      color: #FFD700;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    button:hover {
      background: #FFD700;
      color: #000;
      box-shadow: 0 0 12px #FFD700;
    }

    .small-text {
      font-size: 14px;
      margin-top: 5px;
      color: #FFD700aa;
    }
  </style>
</head>
<body>
  <h1>⚔️ Avalon Lobby ⚔️</h1>

  <div class="card">
    <h2>Create Room</h2>
    <input type="text" id="hostName" placeholder="Enter your name" />
    <br>
    <button onclick="createRoom()">Create Room</button>
  </div>

  <div class="card">
    <h2>Join Room</h2>
    <input type="text" id="playerName" placeholder="Enter your name" />
    <br>
    <input type="text" id="roomCode" placeholder="Enter room code" />
    <br>
    <button onclick="joinRoom()">Join Room</button>
    <p class="small-text">Ask the host for the code ⚔️</p>
  </div>

  <script>
    const SUPABASE_URL = "https://arpeyanztddyhczqhdyw.supabase.co";
    const SUPABASE_ANON = "YOUR_SUPABASE_ANON_KEY";
    const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

    function randomCode() {
      return Math.random().toString(36).substring(2, 7).toUpperCase();
    }

    async function createRoom() {
      const name = document.getElementById("hostName").value.trim();
      if (!name) return alert("Enter your name!");

      const code = randomCode();
      const { data: room, error } = await client.from("rooms").insert([{ code, state: "waiting" }]).select().single();

      if (error) return alert("Error creating room");

      const { data: player } = await client.from("players").insert([{ name, room_id: room.id, is_host: true }]).select().single();

      window.location.href = `room.html?room=${code}&player=${player.id}`;
    }

    async function joinRoom() {
      const name = document.getElementById("playerName").value.trim();
      const code = document.getElementById("roomCode").value.trim().toUpperCase();
      if (!name || !code) return alert("Enter your name and code!");

      const { data: room } = await client.from("rooms").select().eq("code", code).single();
      if (!room) return alert("Room not found!");

      const { data: player } = await client.from("players").insert([{ name, room_id: room.id, is_host: false }]).select().single();

      window.location.href = `room.html?room=${code}&player=${player.id}`;
    }
  </script>
</body>
</html>
